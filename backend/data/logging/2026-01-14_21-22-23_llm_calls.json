{
  "timestamp": "2026-01-14T21:22:23",
  "purpose": "image_prompt",
  "model": "gemini-2.5-pro",
  "prompt": "Decide whether this section needs an image.\n\nSection Title: 7. API Design and Integration\nSection Content:\nThe system is exposed through a well-defined API built with FastAPI, designed for ease of integration and real-time progress updates.\n\n### 7.1 FastAPI Endpoints\n\nThe API consists of three primary endpoints:\n\n1.  **Upload File:** A `POST` request to `/api/upload` allows users to upload source documents via multipart/form-data. It returns a `file_id` for use in the generation step.\n\n2.  **Generate Document:** A `POST` request to `/api/generate` initiates the document generation workflow. The request body specifies the output format, LLM providers and models, and sources (which can be file IDs, URLs, or raw text). This endpoint streams progress updates using Server-Sent Events (SSE).\n\n    ```bash\n    POST /api/generate\n    Content-Type: application/json\n    X-Google-Key: <gemini_api_key>\n\n    {\n      \"output_format\": \"pdf\",\n      \"sources\": [\n        {\"type\": \"file\", \"file_id\": \"f_abc123\"}\n      ]\n    }\n    ```\n\n3.  **Download Generated File:** A `GET` request to `/api/download/{file_id}/{format}/{filename}` retrieves the final generated PDF or PPTX file.\n\n### 7.2 Authentication and API Keys\n\nAuthentication is handled via provider-specific API keys passed in request headers, such as `X-Google-Key` for Gemini, `X-OpenAI-Key` for OpenAI, and `X-Anthropic-Key` for Anthropic. This header-based approach allows users to securely use their own API keys without requiring server-side storage.\n\n### 7.3 Server-Sent Events (SSE) for Progress\n\nServer-Sent Events (SSE) are used to stream real-time progress updates from the server to the client. SSE was chosen over WebSockets due to its simplicity, reliance on standard HTTP, automatic reconnection capabilities, and compatibility with most proxies. The SSE stream includes several event types:\n\n*   `progress`: Provides updates on the current workflow step (e.g., `parse_content`, `transform_content`).\n*   `cache_hit`: Indicates that the request was served from the cache.\n*   `complete`: Signals the end of the process and provides the download URL.\n*   `error`: Reports any failures that occurred during generation.\n\nRules:\n- If an image is NOT needed, return exactly: none\n- If an image IS needed, return a single concise image prompt.\n- Use ONLY concepts present in the content.\n- Do NOT add new facts, tools, or labels.\n- The prompt should describe what to depict clearly.\n",
  "response": "A sequence diagram showing the API workflow: 1. A client sends a POST request to `/api/upload` and receives a `file_id`. 2. The client sends a POST request to `/api/generate`, including the `file_id` and an API key in the header. 3. The server streams real-time progress updates using Server-Sent Events (SSE). 4. The client sends a GET request to `/api/download` to retrieve the final file.",
  "input_tokens": 606,
  "output_tokens": 101,
  "latency_seconds": 16.267
}